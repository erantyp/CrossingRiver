<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ (Stages 1~5)</title>
<style>
  :root { --bg:#f4fbff; --ink:#1f2937; --accent:#0ea5e9; --card:#ffffffcc; }
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,sans-serif;background:var(--bg);color:var(--ink)}
  .hidden{display:none!important}
  .center-col{min-height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}
  .btn{padding:12px 18px;border-radius:14px;border:1px solid #dbe5ef;font-size:16px;font-weight:700;cursor:pointer;background:#fff;box-shadow:0 6px 14px rgba(0,0,0,.06);transition:.2s}
  .btn.primary{background:linear-gradient(180deg,#38bdf8,#0ea5e9);color:#fff;border:none}
  .btn.next{background:linear-gradient(180deg,#34d399,#059669);color:#fff;border:none}
  .container{max-width:1100px;margin:0 auto;padding:20px}
  .hud{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;margin:10px 0 18px}
  .pill{padding:6px 10px;border-radius:999px;background:#eef6ff;color:#1d4ed8;border:1px solid #c7dbff;font-weight:700}

  /* ë³´ë“œ ë ˆì´ì•„ì›ƒ */
  .board{position:relative;width:100%;height:540px;border-radius:18px;overflow:hidden;border:1px solid #e5e7eb;background:#bfe8ff}
  .river{
    position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);
    width:50%;
    background:linear-gradient(180deg,#8dd7ff,#54b9f0 60%,#4aa8e0)
  }
  .bank{
    position:absolute;top:0;bottom:0;width:25%;
    display:flex;flex-direction:column;justify-content:flex-end;gap:8px;
    padding:10px 12px 28px;
    background:linear-gradient(#cfe9a6,#a7d47d);z-index:1
  }
  .bank.left{left:0}.bank.right{right:0}
  .bank-title{position:absolute;top:8px;left:50%;transform:translateX(-50%);font-weight:800;background:#ffffffcc;padding:2px 10px;border-radius:999px}
  .dock{display:flex;flex-wrap:wrap;gap:8px}

  .boat-wrap{
    position:absolute;top:calc(50% - 165px);
    transform:translate(-50%,-50%);
    transition:left 1.1s cubic-bezier(0.65,0,0.35,1);
    z-index:2
  }
  .boat-wrap.moving{animation:bob .5s ease-in-out infinite alternate}
  @keyframes bob{from{transform:translate(-50%,-50%) rotate(-1deg)}to{transform:translate(-50%,-52%) rotate(1deg)}}

  .boat{position:relative;width:320px;max-width:80%;height:110px;background:#8b5a2b;border-radius:12px}
  .boat.big{width:420px; max-width:90%;}
  .slots{position:absolute;left:8px;right:8px;bottom:8px;height:88px;display:flex;gap:10px;justify-content:center;align-items:flex-end;flex-wrap:wrap}
  .slot{width:80px;height:80px;border:2px dashed #ffffff99;border-radius:12px;background:#ffffff22;display:flex;align-items:center;justify-content:center;color:#fff}

  .token{width:80px;height:80px;border-radius:16px;background:var(--card);border:1px solid #e5e7eb;box-shadow:0 6px 12px rgba(0,0,0,.08);display:flex;align-items:center;justify-content:center;font-size:36px;cursor:grab}

  .result{position:absolute;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:10}
  .result .card{background:#fff;border-radius:18px;padding:24px;width:min(560px,88vw);text-align:center}

  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:100}
  .modal{background:#fff;border-radius:16px;padding:20px;max-width:600px}

  .times{margin:12px auto 0;max-width:420px;text-align:left}
  .times .row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #e5e7eb}
  .times .row.total{font-weight:800}
</style>
</head>
<body>
<main id="menu" class="center-col">
  <h1>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ</h1>
  <button class="btn primary" id="startBtn">ğŸš€ ê²Œì„ ì‹œì‘</button>
</main>

<div id="rulesModal" class="modal-backdrop">
  <div class="modal">
    <h3>ê²Œì„ ê·œì¹™</h3>
    <p id="ruleText"></p>
    <div style="margin-top:14px;text-align:right">
      <button class="btn primary" id="closeRules">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<section id="game" class="container hidden">
  <div class="hud">
    <div class="left">
      <span class="pill">ìŠ¤í…Œì´ì§€: <b id="stageName"></b></span>
      <span class="pill">ë³´íŠ¸ ìœ„ì¹˜: <b id="boatSideLabel"></b></span>
      <span class="pill">ê²½ê³¼ì‹œê°„: <b id="elapsed">00:00</b></span>
    </div>
    <div class="right">
      <button class="btn small" id="rulesBtn">ğŸ“œ ê·œì¹™</button>
      <button class="btn small" id="resetBtn">â†º ë¦¬ì…‹</button>
      <button class="btn small primary" id="moveBtn">â›µ ì´ë™</button>
    </div>
  </div>

  <div class="board">
    <div class="bank left"><div class="bank-title">ì™¼ìª½ ë‘‘</div><div class="dock" id="dock-left"></div></div>
    <div class="river"></div>
    <div class="boat-wrap" id="boatWrap">
      <div class="boat" id="boat"></div>
    </div>
    <div class="bank right"><div class="bank-title">ì˜¤ë¥¸ìª½ ë‘‘</div><div class="dock" id="dock-right"></div></div>
    <div class="result" id="overlay">
      <div class="card">
        <h2 id="overlayTitle"></h2>
        <p id="overlayMsg"></p>
        <div id="finalTimes" class="times hidden"></div>
        <p id="timeMsg"></p>
        <button class="btn next" id="nextBtn">ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
        <button class="btn primary" id="replayBtn">ë‹¤ì‹œ ë„ì „</button>
        <button class="btn" id="homeBtn">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>
</section>

<script>
const STAGES=[
 {name:"1ë‹¨ê³„ Â· ëŠ‘ëŒ€, ì–‘ ê·¸ë¦¬ê³  ì–‘ë°°ì¶”",tokens:["person","wolf","goat","cabbage"],capacity:2,requiresPerson:true,
  ruleText:"ì‚¬ëŒë§Œ ë°°ì˜ ë…¸ë¥¼ ì €ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ëŒì´ ì—†ëŠ” ë‘‘ì—ì„œ ëŠ‘ëŒ€+ì–‘ ë˜ëŠ” ì–‘+ì–‘ë°°ì¶”ê°€ ë‚¨ìœ¼ë©´ ê²Œì„ ì˜¤ë²„ì…ë‹ˆë‹¤.",rules:(pos,side)=>{/* ë™ì¼ */}},
 {name:"2ë‹¨ê³„ Â· ì„ êµì‚¬ì™€ ë±€íŒŒì´ì–´",tokens:["M1","M2","M3","V1","V2","V3"],capacity:2,requiresPerson:false,
  ruleText:"ì„ êµì‚¬/ë±€íŒŒì´ì–´ ëª¨ë‘ ë°°ë¥¼ ëª° ìˆ˜ ìˆê³ ...",rules:(pos,side)=>{/* ë™ì¼ */}},
 {name:"3ë‹¨ê³„ Â· ì—˜í”„Â·ì¢€ë¹„Â·ë§ˆë²•ì‚¬",tokens:["ElfBoss","Elf","ZombieBoss","Zombie","WizardBoss","Wizard"],capacity:2,requiresPerson:false,
  ruleText:"ë¶€í•˜ëŠ” ìê¸° ë‘ëª©ì´ ìˆì„ ë•Œë§Œ ì•ˆì „...",rules:(pos,side)=>{/* ë™ì¼ */}},
 {name:"4ë‹¨ê³„ Â· ì™¸ê³„ì¸! ì‚¬ìœ¡ì‚¬ì™€ ì‚¬ì",tokens:["A","A1","A2","B","B1","B2","Keeper","Lion"],capacity:2,requiresPerson:false,
  ruleText:"A/B ë¶€ëª¨ê°€ ì—†ìœ¼ë©´ ìƒëŒ€ì˜ ì•„ì´...",rules:(pos,side)=>{/* ë™ì¼ */}},
 {name:"5ë‹¨ê³„ Â· ì¡°ë ¨ì‚¬ì™€ ë™ë¬¼ë“¤",tokens:["Trainer","Elephant","Tiger","Dog","Cat","Mouse"],capacity:4,requiresPerson:true,
  ruleText:"ë°° ì•ˆ: ì¡°ë ¨ì‚¬ê°€ í•­ìƒ ë™ìŠ¹í•´ì•¼ í•¨. ì½”ë¼ë¦¬ëŠ” ì˜¤ì§ ì¥ë§Œ ë™ìŠ¹ ê°€ëŠ¥. í˜¸ë‘ì´+ê°•ì•„ì§€ëŠ” í•¨ê»˜ íƒœìš°ë©´ ë‹¤ë¥¸ ë™ë¬¼ ë¶ˆê°€. ë‘‘ì—ì„œëŠ” ì¡°ë ¨ì‚¬ ì—†ì„ ë•Œ ë‹¤ì„¯ ìŒì´ ì‹¸ì›€.",rules:(pos,side)=>{/* ë™ì¼ */}}
];

const $=s=>document.querySelector(s);
const leftDock=$("#dock-left"),rightDock=$("#dock-right"),boatWrap=$("#boatWrap"),boat=$("#boat");

function renderSlots(){
  boat.innerHTML="";
  const st=STAGES[state.stageIndex];
  const slotsCount=(state.stageIndex===4?4:2); // Stage5(index4)ë§Œ 4ì¹¸
  boat.style.width=(state.stageIndex===4?"420px":"320px");
  boat.style.height=(state.stageIndex===4?"140px":"110px");
  const slots=document.createElement("div");
  slots.className="slots";
  for(let i=0;i<slotsCount;i++){
    const s=document.createElement("div");
    s.className="slot";s.id="slot"+i;
    slots.appendChild(s);
  }
  boat.appendChild(slots);
}

let state={stageIndex:0,positions:{},boatSide:"L",moving:false,startTs:null,timerId:null};

function startStage(i){
  state.stageIndex=i;
  renderSlots();
  const st=STAGES[i];
  state.positions={}; st.tokens.forEach(t=>state.positions[t]="L");
}
// helpers to rebuild boat slots & size (stage-specific)
function buildBoatSlots(n){
  const container = document.querySelector('#boat .slots');
  if(!container) return;
  const cur = Array.from(container.querySelectorAll('.slot'));
  // trim or extend
  if(cur.length > n){ cur.slice(n).forEach(el=> el.remove()); }
  else if(cur.length < n){ for(let i=cur.length; i<n; i++){ const d=document.createElement('div'); d.className='slot'; container.appendChild(d); } }
}
function setBoatSize(cap){ document.querySelector('#boat')?.classList.toggle('big', cap>=4); }

</script>
</body>
</html>
